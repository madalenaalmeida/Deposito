<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Painel de Administração</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.1/xlsx.full.min.js"></script>
  <link rel="stylesheet" href="admin-style.css">
</head>
 <!-- Navbar -->
 <nav class="navbar">
  <a href="index.html" class="voltar-inicio">
    <i class="fas fa-home"></i> <!-- Ícone de casa -->
  </a>
  <span class="navbar-text">Área Administrativa</span>
</nav>
<br>
<br>
<br>
  <div class="admin-container"> 
    
    <h1>Painel de Administração</h1>
    
    <h2>Pedidos por Ramo</h2>
    <table id="pedidosTabela">
      <thead>
        <tr>
          <th>Ramo</th>
          <th>Produto</th>
          <th>Tamanho</th>
          <th>Quantidade</th>
          <th>Observações</th>
          <th>Ações</th> <!-- Adicionando uma coluna de ações -->
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    
    <h2>Pedidos Detalhados</h2>
    <table id="pedidosDetalhadosTabela">
      <thead>
        <tr>
          <th>Nome</th>
          <th>Email</th>
          <th>Produto</th>
          <th>Tamanho</th>
          <th>Quantidade</th>
          <th>Observações</th>
          <th>Ações</th> <!-- Adicionando uma coluna de ações -->
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <h2>Pedidos Agrupados por Ramo</h2>
    <div id="groupedOrdersContainer"></div>

    <div class="buttons-container">
      <button onclick="exportarParaExcel('pedidosTabela', 'pedidos_ramos')">Exportar Pedidos por Ramo</button>
      <button onclick="exportarParaExcel('pedidosDetalhadosTabela', 'pedidos_detalhados')">Exportar Pedidos Detalhados</button>
      <button onclick="limparDados()">Limpar Dados</button>
    </div>

  </div>
  <section>
    <h2>Definir Períodos de Encomenda</h2>
    <div class="formulario-submissao">
    <form id="datesForm">
      <label for="start-date-input">Data de Início:</label>
      <input type="date" id="start-date-input" required>
  
      <label for="end-date-input">Data de Fim:</label>
      <input type="date" id="end-date-input" required>
  
      <button type="submit">Salvar Datas</button>
    </form>
  </div>
  </section>

  <script>
    function exportarParaExcel(tableId, fileName) {
      var wb = XLSX.utils.table_to_book(document.getElementById(tableId), {sheet: fileName});
      XLSX.writeFile(wb, fileName + ".xlsx");
    }

    function updateOrdersTable() {
      const pedidosTabela = document.getElementById('pedidosTabela').getElementsByTagName('tbody')[0];
      const pedidosDetalhadosTabela = document.getElementById('pedidosDetalhadosTabela').getElementsByTagName('tbody')[0];
      pedidosTabela.innerHTML = '';
      pedidosDetalhadosTabela.innerHTML = '';
      let pedidos = JSON.parse(localStorage.getItem("pedidos")) || [];
      console.log('Pedidos carregados:', pedidos);

      // Agrupamento para a primeira tabela
      const agrupados = {};
      pedidos.forEach(pedido => {
        const key = `${pedido.ramo}|${pedido.produto}|${pedido.tamanho}`;
        if (!agrupados[key]) {
          agrupados[key] = {
            ramo: pedido.ramo,
            produto: pedido.produto,
            tamanho: pedido.tamanho,
            quantidade: 0,
            observacoes: []
          };
        }
        agrupados[key].quantidade += Number(pedido.quantidade) || 0;
        if (pedido.especialidade) agrupados[key].observacoes.push(pedido.especialidade);
      });

      Object.values(agrupados).forEach(pedido => {
        const row = pedidosTabela.insertRow();
        row.insertCell(0).textContent = pedido.ramo;
        row.insertCell(1).textContent = pedido.produto;
        row.insertCell(2).textContent = pedido.tamanho;
        row.insertCell(3).textContent = pedido.quantidade;
        row.insertCell(4).textContent = pedido.observacoes.join(", ");
        const actionsCell = row.insertCell(5);
        actionsCell.innerHTML = `
          <button onclick="eliminarPedido('${pedido.ramo}', '${pedido.produto}', '${pedido.tamanho}')">Eliminar</button>
        `;
      });

      // Tabela detalhada
      pedidos.forEach(pedido => {
        let rowDetalhada = pedidosDetalhadosTabela.insertRow();
        rowDetalhada.insertCell(0).textContent = pedido.nome;
        rowDetalhada.insertCell(1).textContent = pedido.email;
        rowDetalhada.insertCell(2).textContent = pedido.produto;
        rowDetalhada.insertCell(3).textContent = pedido.tamanho;
        rowDetalhada.insertCell(4).textContent = pedido.quantidade;
        rowDetalhada.insertCell(5).textContent = pedido.especialidade || '';
        const actionsCell = rowDetalhada.insertCell(6);
        actionsCell.innerHTML = `
          <button onclick="eliminarPedido('${pedido.nome}', '${pedido.produto}', '${pedido.tamanho}')">Eliminar</button>
        `;
      });
    }

    function eliminarPedido(ramo, produto, tamanho) {
      let pedidos = JSON.parse(localStorage.getItem("pedidos")) || [];
      pedidos = pedidos.filter(pedido => !(pedido.ramo === ramo && pedido.produto === produto && pedido.tamanho === tamanho));
      localStorage.setItem("pedidos", JSON.stringify(pedidos));
      updateOrdersTable(); // Atualiza a tabela após eliminar o pedido
    }

    function limparDados() {
      if (confirm("Tem certeza de que deseja eliminar todos os pedidos? Essa ação não pode ser desfeita.")) {
        localStorage.removeItem("pedidos");
        updateOrdersTable();
      }
    }

    function carregarPedidos() {
      updateOrdersTable();
    }
    window.onload = carregarPedidos;
    
  </script>
    

<script>
  // Ao submeter o formulário, salva as datas no localStorage
  document.getElementById('datesForm').addEventListener('submit', function(event) {
    event.preventDefault();

    // Pega os valores das datas do formulário
    const startDate = document.getElementById('start-date-input').value;
    const endDate = document.getElementById('end-date-input').value;

    // Salva as datas no localStorage
    localStorage.setItem('dataInicio', startDate);
    localStorage.setItem('dataFim', endDate);

    // Exibe uma mensagem de confirmação
    alert('Datas salvas com sucesso!');
  });
</script>
<br>
<footer class="footer">
  <div class="footer-content">
    <p>&copy; 2025 Guias de Viseu - Depósito. Todos os direitos reservados.</p>
  </div>
</footer>
</body>
</html>
